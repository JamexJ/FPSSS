-- ======================================================
-- üìå FPS THANHLONG - Mini Spam Button + Anti-Accessories (Fix load ch·∫≠m)
-- -- Ch·ªâ s·ª≠a ph·∫ßn spam: gi·ªØ tool tr√™n tay v√† spam b·∫±ng :Activate()
-- ======================================================

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local playerGui = LocalPlayer:WaitForChild("PlayerGui")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- üîπ Ch·ªù Character v√† Backpack s·∫µn s√†ng
local function WaitForCharacter()
    local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    repeat task.wait() until char:FindFirstChild("HumanoidRootPart") and char:FindFirstChildOfClass("Humanoid")
    return char
end

local function WaitForBackpack()
    return LocalPlayer:WaitForChild("Backpack")
end

-- üîπ X√ìA PH·ª§ KI·ªÜN C·ª¶A B·∫†N
local function removeAllAccessoriesFromCharacter()
    local character = LocalPlayer.Character
    if not character then return end
    for _, item in ipairs(character:GetChildren()) do
        if item:IsA("Accessory") or item:IsA("LayeredClothing")
           or item:IsA("Shirt") or item:IsA("ShirtGraphic")
           or item:IsA("Pants") or item:IsA("BodyColors")
           or item:IsA("CharacterMesh") then
            pcall(function() item:Destroy() end)
        end
    end
end

-- ƒë·∫£m b·∫£o khi spawn l√† ch·∫°y li·ªÅn
LocalPlayer.CharacterAdded:Connect(function()
    task.spawn(function()
        local char = WaitForCharacter()
        for i = 1, 10 do
            removeAllAccessoriesFromCharacter()
            task.wait(0.1)
        end
    end)
end)

if LocalPlayer.Character then
    task.defer(function()
        local char = WaitForCharacter()
        for i = 1, 10 do
            removeAllAccessoriesFromCharacter()
            task.wait(0.1)
        end
    end)
end

-- üîπ ITEM CHO SPAM
local allowedItems = {
    ["Glitched Slap"] = true,
}

-- üîπ SPAM ITEM (S·ª¨A: gi·ªØ tr√™n tay, kh√¥ng nh·∫£ ra li√™n t·ª•c)
-- Gi·ªØ nguy√™n delay g·ªëc b·∫°n ƒë·∫∑t
local InventorySpam = {running = false, delay = 0.185}

-- Helper: t√¨m tool h·ª£p l·ªá ƒëang c·∫ßm (trong Character)
local function getEquippedAllowedTool()
    local char = LocalPlayer.Character
    if not char then return nil end
    for _, v in ipairs(char:GetChildren()) do
        if v:IsA("Tool") and allowedItems[v.Name] then
            return v
        end
    end
    -- c≈©ng th·ª≠ FindFirstChildOfClass cho tr∆∞·ªùng h·ª£p ch·ªâ c√≥ 1 tool
    local t = char:FindFirstChildOfClass("Tool")
    if t and allowedItems[t.Name] then return t end
    return nil
end

-- Helper: t√¨m tool h·ª£p l·ªá trong Backpack
local function findAllowedToolInBackpack()
    local bp = LocalPlayer:FindFirstChild("Backpack")
    if not bp then return nil end
    for _, tool in ipairs(bp:GetChildren()) do
        if tool:IsA("Tool") and allowedItems[tool.Name] then
            return tool
        end
    end
    return nil
end

function InventorySpam:Start()
    if self.running then return end
    self.running = true
    self._stop = false
    task.spawn(function()
        while self.running and not self._stop do
            local char = LocalPlayer.Character
            if not char then
                task.wait(0.2)
                continue
            end

            -- 1) N·∫øu ƒë√£ c√≥ tool h·ª£p l·ªá tr√™n tay -> spam b·∫±ng Activate()
            local equipped = getEquippedAllowedTool()
            if equipped then
                -- pcall ƒë·ªÉ tr√°nh l·ªói n·∫øu Activate kh√¥ng kh·∫£ d·ª•ng
                pcall(function()
                    equipped:Activate()
                end)
                task.wait(self.delay)
            else
                -- 2) N·∫øu ch∆∞a c·∫ßm tool, th·ª≠ equip 1 tool h·ª£p l·ªá t·ª´ Backpack (m·ªôt l·∫ßn)
                local bpTool = findAllowedToolInBackpack()
                if bpTool then
                    pcall(function() bpTool.Parent = char end)
                    -- cho client m·ªôt √≠t th·ªùi gian ƒë·ªÉ equip
                    task.wait(0.05)
                else
                    -- kh√¥ng c√≥ tool n√†o ph√π h·ª£p -> ch·ªù l√¢u h∆°n
                    task.wait(0.3)
                end
            end
        end
    end)
end

function InventorySpam:Stop()
    self.running = false
    self._stop = true
    -- Gi·ªØ h√†nh vi c≈©: tr·∫£ t·∫•t c·∫£ tool tr√™n Character v·ªÅ Backpack
    local backpack = WaitForBackpack()
    local char = LocalPlayer.Character
    if backpack and char then
        for _, tool in ipairs(char:GetChildren()) do
            if tool:IsA("Tool") then
                pcall(function() tool.Parent = backpack end)
            end
        end
    end
end

-- üîπ GUI MINI BUTTON
local old = playerGui:FindFirstChild("FPS_THANHLONG_PANEL")
if old then old:Destroy() end

local gui = Instance.new("ScreenGui")
gui.Name = "FPS_THANHLONG_PANEL"
gui.ResetOnSpawn = false
gui.Parent = playerGui

local panel = Instance.new("Frame", gui)
panel.BackgroundColor3 = Color3.fromRGB(28,28,28)
panel.BorderSizePixel = 0
Instance.new("UICorner", panel).CornerRadius = UDim.new(0, 6)
panel.Size = UDim2.new(0, 60, 0, 28)

local btn = Instance.new("TextButton", panel)
btn.Size = UDim2.new(1, 0, 1, 0)
btn.BackgroundTransparency = 1
btn.Text = "SPAM"
btn.Font = Enum.Font.GothamBold
btn.TextColor3 = Color3.fromRGB(255,255,255)
btn.TextSize = 12

local circle = Instance.new("Frame", panel)
circle.Size = UDim2.new(0, 10, 0, 10)
circle.Position = UDim2.new(1, -12, 0.5, -5)
circle.BackgroundColor3 = Color3.fromRGB(255,40,40)
circle.BorderSizePixel = 0
Instance.new("UICorner", circle).CornerRadius = UDim.new(1, 0)

local state = false
local function updateVisual()
    circle.BackgroundColor3 = state and Color3.fromRGB(50,255,60) or Color3.fromRGB(255,40,40)
end

btn.MouseButton1Click:Connect(function()
    state = not state
    if state then
        InventorySpam:Start()
    else
        InventorySpam:Stop()
    end
    updateVisual()
end)
updateVisual()

-- ƒë·∫∑t g√≥c ph·∫£i
panel.Position = UDim2.new(1, -70, 0, 50)
panel.AnchorPoint = Vector2.new(0, 0)

-- ph√≠m t·∫Øt ALT TR√ÅI
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.LeftAlt then
        state = not state
        if state then
            InventorySpam:Start()
        else
            InventorySpam:Stop()
        end
        updateVisual()
    end
end)
