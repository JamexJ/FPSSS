-- ======================================================
-- üìå FPS THANHLONG - Keep Tool OnHand + AutoClear Accessories (Full + Hotkey)
-- ======================================================

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local playerGui = LocalPlayer:WaitForChild("PlayerGui")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- üîπ Ch·ªù Character v√† Backpack s·∫µn s√†ng
local function WaitForCharacter(plr)
    local char = plr.Character or plr.CharacterAdded:Wait()
    repeat task.wait() until char:FindFirstChild("HumanoidRootPart") and char:FindFirstChildOfClass("Humanoid")
    return char
end

local function WaitForBackpack()
    return LocalPlayer:WaitForChild("Backpack")
end

-- üîπ X√ìA PH·ª§ KI·ªÜN / QU·∫¶N √ÅO
local function clearAccessories(character)
    if not character then return end
    for _, item in ipairs(character:GetChildren()) do
        if item:IsA("Accessory") or item:IsA("LayeredClothing")
        or item:IsA("Shirt") or item:IsA("ShirtGraphic")
        or item:IsA("Pants") or item:IsA("BodyColors")
        or item:IsA("CharacterMesh") then
            pcall(function() item:Destroy() end)
        end
    end
end

-- üîπ Auto clear cho player
local function setupAutoClear(plr)
    if plr.Character then
        clearAccessories(plr.Character)
    end
    plr.CharacterAdded:Connect(function(char)
        task.spawn(function()
            WaitForCharacter(plr)
            task.wait(0.2)
            clearAccessories(char)
        end)
    end)
end

-- B·∫£n th√¢n b·∫°n c≈©ng clear
setupAutoClear(LocalPlayer)

-- Nh·ªØng ng∆∞·ªùi kh√°c c≈©ng clear khi join/reset
for _, plr in ipairs(Players:GetPlayers()) do
    setupAutoClear(plr)
end
Players.PlayerAdded:Connect(setupAutoClear)

-- üîπ QU√âT TO√ÄN MAP, xo√° c·∫£ ph√¢n th√¢n c√≥ Humanoid
local function clearAllHumanoids()
    -- X√≥a ƒë·ªì c·ªßa t·∫•t c·∫£ ng∆∞·ªùi ch∆°i
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr.Character then
            clearAccessories(plr.Character)
        end
    end
    -- X√≥a ƒë·ªì c·ªßa c√°c ph√¢n th√¢n / NPC trong workspace
    for _, model in ipairs(workspace:GetChildren()) do
        if model:FindFirstChildOfClass("Humanoid") and model:FindFirstChild("HumanoidRootPart") and not Players:GetPlayerFromCharacter(model) then
            clearAccessories(model)
        end
    end
end

-- üîπ Auto clear ƒë·ªãnh k·ª≥ (3 gi√¢y m·ªôt l·∫ßn)
task.spawn(function()
    while true do
        task.wait(3)
        clearAllHumanoids()
    end
end)

-- üîπ GI·ªÆ TOOL TR√äN TAY LI√äN T·ª§C
local allowedItems = {
    ["Glitched Slap"] = true, -- thay t√™n item b·∫°n mu·ªën gi·ªØ
}

local InventorySpam = {running = false, delay = 0.1}

function InventorySpam:Start()
    if self.running then return end
    self.running = true
    self._stop = false
    task.spawn(function()
        while self.running and not self._stop do
            local backpack = WaitForBackpack()
            local char = LocalPlayer.Character
            if backpack and char then
                for _, tool in ipairs(backpack:GetChildren()) do
                    if not self.running then break end
                    if tool:IsA("Tool") and allowedItems[tool.Name] then
                        pcall(function() tool.Parent = char end)
                    end
                end
            end
            task.wait(self.delay)
        end
    end)
end

function InventorySpam:Stop()
    self.running = false
    self._stop = true
    local backpack = WaitForBackpack()
    local char = LocalPlayer.Character
    if backpack and char then
        for _, tool in ipairs(char:GetChildren()) do
            if tool:IsA("Tool") then
                pcall(function() tool.Parent = backpack end)
            end
        end
    end
end

-- üîπ GUI MINI BUTTON
local old = playerGui:FindFirstChild("FPS_THANHLONG_PANEL")
if old then old:Destroy() end

local gui = Instance.new("ScreenGui")
gui.Name = "FPS_THANHLONG_PANEL"
gui.ResetOnSpawn = false
gui.Parent = playerGui

local panel = Instance.new("Frame", gui)
panel.BackgroundColor3 = Color3.fromRGB(28,28,28)
panel.BorderSizePixel = 0
Instance.new("UICorner", panel).CornerRadius = UDim.new(0, 6)
panel.Size = UDim2.new(0, 120, 0, 28)

local btn = Instance.new("TextButton", panel)
btn.Size = UDim2.new(0.5, 0, 1, 0)
btn.BackgroundTransparency = 1
btn.Text = "SPAM"
btn.Font = Enum.Font.GothamBold
btn.TextColor3 = Color3.fromRGB(255,255,255)
btn.TextSize = 12

local circle = Instance.new("Frame", panel)
circle.Size = UDim2.new(0, 10, 0, 10)
circle.Position = UDim2.new(0.5, -12, 0.5, -5)
circle.BackgroundColor3 = Color3.fromRGB(255,40,40)
circle.BorderSizePixel = 0
Instance.new("UICorner", circle).CornerRadius = UDim.new(1, 0)

local state = false
local function updateVisual()
    circle.BackgroundColor3 = state and Color3.fromRGB(50,255,60) or Color3.fromRGB(255,40,40)
end

btn.MouseButton1Click:Connect(function()
    state = not state
    if state then
        InventorySpam:Start()
    else
        InventorySpam:Stop()
    end
    updateVisual()
end)
updateVisual()

-- üîπ N√∫t CLEAR th·ªß c√¥ng
local clearBtn = Instance.new("TextButton", panel)
clearBtn.Size = UDim2.new(0.5, 0, 1, 0)
clearBtn.Position = UDim2.new(0.5, 0, 0, 0)
clearBtn.BackgroundTransparency = 1
clearBtn.Text = "CLEAR"
clearBtn.Font = Enum.Font.GothamBold
clearBtn.TextColor3 = Color3.fromRGB(255,200,100)
clearBtn.TextSize = 12

clearBtn.MouseButton1Click:Connect(clearAllHumanoids)

-- ƒë·∫∑t g√≥c ph·∫£i
panel.Position = UDim2.new(1, -130, 0, 50)
panel.AnchorPoint = Vector2.new(0, 0)

-- üîπ Ph√≠m t·∫Øt
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    -- ALT tr√°i ‚Üí b·∫≠t/t·∫Øt gi·ªØ tool
    if input.KeyCode == Enum.KeyCode.LeftAlt then
        state = not state
        if state then
            InventorySpam:Start()
        else
            InventorySpam:Stop()
        end
        updateVisual()
    end
    -- Numpad Enter ‚Üí Clear Accessories
    if input.KeyCode == Enum.KeyCode.KeypadEnter then
        clearAllHumanoids()
    end
end)
